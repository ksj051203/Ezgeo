<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" >
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Title</title>
    <style>
    </style>
</head>
<body>
    <h1 th:text="${board.board_title}"></h1>
    <p th:text="${board.board_writer}"></p>
    <p th:text="${board.board_content}"></p>
    <p th:text="${board.board_write_date}"></p>
    <p th:text="${board.board_modify_date}"></p>
    <a th:href="@{/delete(board_id=${board.board_id})}">삭제</a>
    <a th:href="@{/modify/{board_id}(board_id=${board.board_id})}">수정</a>

    <form id="frm" name="frm" th:action="@{/list/addComment/{board_id}(board_id=${board.board_id})}" method="post">
        <input type="text" name="comment_writer" value="작성자">
        <input type="text" name="comment_content" value="내용">
        <input type="hidden" name="depth" value="0">
        <input type="hidden" name="board_id" th:value="${board.board_id}">
        <button type="submit">작성</button>
    </form>


    <div th:each="comment, loop: ${comment}">
            <span th:text="${comment.content}"></span>
            <button th:id = "${comment.id}" class = "writeComment" type="submit" th:attr="data-depth=${comment.depth}">댓글 등록</button>
    </div>


    <button id="axiosTest">test</button>

<script>
        const writeComment = document.querySelectorAll('.writeComment');
        const writeCommentSize = writeComment.length;

        let path = location.pathname;
        console.log(path);
        let board_id = path.split('/')[2];


        for(let i = 0; i<writeCommentSize; i++){
            let comment = writeComment[i];
            comment.addEventListener("click", function(){
                let id = comment.id
                let depth = parseInt(comment.dataset.depth);

                console.log(id)
                const input1 = document.createElement("input");
                // 내용
                const input2 = document.createElement("input");
                // 등록
                const button1 = document.createElement("button");
                // 삭제
                const button2 = document.createElement("button");

                input1.innerHTML = "작성자";
                input2.innerHTML = "내용";
                button1.innerHTML = "답글 작성";
                button2.innerHTML="취소";

                input1.setAttribute("id", "comment_writer");
                input2.setAttribute("id", "comment_content");
                button1.setAttribute("id", "write");


                const divEl = document.createElement("div");

                divEl.appendChild(input1);
                divEl.appendChild(input2);
                divEl.appendChild(button1);
                divEl.appendChild(button2);

                document.body.appendChild(divEl);

                // button1이 눌러진다면 axios post로 data 보내기
                document.getElementById("write").addEventListener("click", async function(){

                    try{
                        let comment_writer = document.getElementById('comment_writer').value;
                        let comment_content = document.getElementById('comment_content').value;

                        console.log(`depth:${depth}`)
                        await axios.post(`/list/addComment/axios/${board_id}`,
                            {

                                parent_id : id,
                                comment_writer : comment_writer,
                                comment_content : comment_content,
                                board_id : board_id,
                                depth : depth+1
                            },
                            {
                                "Content-Type" : `application/json`,
                            },
                        )
                    }

                    catch (e){
                        alert(e);
                    }
                })
                //writer는 input1의 내용, content는 input2의 내용, comment_id는 a.i, parent_id는 id로 넣어주면 됨
            })

        }



    document.getElementById('axiosTest').addEventListener('click', async function (){
        try {
            const rtnData = await axios.post('/axios',
                {
                    parent_id : 36,
                    comment_sequence : 1,
                    comment_writer : 'sejin',
                    comment_content : 'hi'
                },
                {
                    "Content-Type" : `application/json`,
                },

            );
        } catch (e) {
            alert(e);
        }
    });

</script>
</body>
</html>